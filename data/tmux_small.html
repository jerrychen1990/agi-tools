<!DOCTYPE html>
<!-- saved from url=(0084)http://louiszhai.github.io/2017/09/30/tmux/#Tmux%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4 -->
<html class=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Tmux使用手册 | louis blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="tmux 终端复用 会话 tmux配置 快捷键 快捷指令 鼠标支持 面板切换 复制模式 使用Mac系统粘贴板 保存tmux会话 tmux resurrect tmux continuum tpm 会话分享 结对编程 tmux脚本化 开机自动启用web服务器">
<meta property="og:type" content="article">
<meta property="og:title" content="Tmux使用手册">
<meta property="og:url" content="http://louiszhai.github.io/2017/09/30/tmux/index.html">
<meta property="og:site_name" content="louis blog">
<
    
    <div class="article-entry" itemprop="articleBody" style="padding-top: 896.4px;">
      
          <span class="toc-arrow"></span>
<div id="toc" class="toc-article">
    <div class="toc-title">目录</div>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%AF%BC%E8%AF%BB"><span class="toc-text">导读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E7%AE%80%E4%BB%8B"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E4%BC%9A%E8%AF%9D"><span class="toc-text">会话</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%96%B0%E5%BB%BA%E4%BC%9A%E8%AF%9D"><span class="toc-text">新建会话</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%96%AD%E5%BC%80%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D"><span class="toc-text">断开当前会话</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E8%BF%9B%E5%85%A5%E4%B9%8B%E5%89%8D%E7%9A%84%E4%BC%9A%E8%AF%9D"><span class="toc-text">进入之前的会话</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%85%B3%E9%97%AD%E4%BC%9A%E8%AF%9D"><span class="toc-text">关闭会话</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%9A%84%E4%BC%9A%E8%AF%9D"><span class="toc-text">查看所有的会话</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#Tmux%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4"><span class="toc-text">Tmux快捷指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E7%81%B5%E6%B4%BB%E7%9A%84%E9%85%8D%E7%BD%AE%E6%80%A7"><span class="toc-text">灵活的配置性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E4%BF%AE%E6%94%B9%E6%8C%87%E4%BB%A4%E5%89%8D%E7%BC%80"><span class="toc-text">修改指令前缀</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%96%B0%E5%A2%9E%E9%9D%A2%E6%9D%BF"><span class="toc-text">新增面板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%BC%80%E5%90%AF%E9%BC%A0%E6%A0%87%E6%94%AF%E6%8C%81"><span class="toc-text">开启鼠标支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%BF%AB%E9%80%9F%E9%9D%A2%E6%9D%BF%E5%88%87%E6%8D%A2"><span class="toc-text">快速面板切换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E9%9D%A2%E6%9D%BF%E5%A4%A7%E5%B0%8F%E8%B0%83%E6%95%B4"><span class="toc-text">面板大小调整</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E9%9D%A2%E6%9D%BF%E6%9C%80%E5%A4%A7%E5%8C%96"><span class="toc-text">面板最大化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E7%AA%97%E5%8F%A3%E5%8F%98%E4%B8%BA%E9%9D%A2%E6%9D%BF"><span class="toc-text">窗口变为面板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="toc-text">其他配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%81%A2%E5%A4%8D%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4"><span class="toc-text">恢复用户空间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F"><span class="toc-text">复制模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%8D%E5%88%B6%E5%92%8C%E9%80%89%E6%8B%A9%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-text">自定义复制和选择快捷键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#Buffer%E7%BC%93%E5%AD%98"><span class="toc-text">Buffer缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E4%BD%BF%E7%94%A8%E7%B3%BB%E7%BB%9F%E7%B2%98%E8%B4%B4%E6%9D%BF"><span class="toc-text">使用系统粘贴板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E4%BF%9D%E5%AD%98Tmux%E4%BC%9A%E8%AF%9D"><span class="toc-text">保存Tmux会话</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#Tmux-Resurrect"><span class="toc-text">Tmux Resurrect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#Tmux-Continuum"><span class="toc-text">Tmux Continuum</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#Tpm"><span class="toc-text">Tpm</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E4%BC%9A%E8%AF%9D%E5%85%B1%E4%BA%AB"><span class="toc-text">会话共享</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E7%BB%93%E5%AF%B9%E7%BC%96%E7%A8%8B"><span class="toc-text">结对编程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%85%B1%E4%BA%AB%E8%B4%A6%E5%8F%B7-amp-%E7%BB%84%E4%BC%9A%E8%AF%9D"><span class="toc-text">共享账号&amp;组会话</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E7%8B%AC%E7%AB%8B%E8%B4%A6%E5%8F%B7-amp-Socket%E5%85%B1%E4%BA%AB%E4%BC%9A%E8%AF%9D"><span class="toc-text">独立账号&amp;Socket共享会话</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#Tmux%E4%BC%98%E5%8C%96"><span class="toc-text">Tmux优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E8%AE%BE%E7%BD%AE%E7%AA%97%E5%8F%A3%E9%9D%A2%E6%9D%BF%E8%B5%B7%E5%A7%8B%E5%BA%8F%E5%8F%B7"><span class="toc-text">设置窗口面板起始序号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8A%B6%E6%80%81%E6%A0%8F"><span class="toc-text">自定义状态栏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%BC%80%E5%90%AF256-colors%E6%94%AF%E6%8C%81"><span class="toc-text">开启256 colors支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%85%B3%E9%97%AD%E9%BB%98%E8%AE%A4%E7%9A%84rename%E6%9C%BA%E5%88%B6"><span class="toc-text">关闭默认的rename机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%8E%BB%E6%8E%89%E5%B0%8F%E5%9C%86%E7%82%B9"><span class="toc-text">去掉小圆点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E8%84%9A%E6%9C%AC%E5%8C%96%E7%9A%84Tmux"><span class="toc-text">脚本化的Tmux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%90%AF%E7%94%A8Web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">开机自动启用Web服务器</span></a></li></ol>
</div>
      
        <p><strong>本文首发于CSDN网站，下面的版本又经过进一步的修订。</strong></p>
<h3 id="导读"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%AF%BC%E8%AF%BB" class="headerlink" title="导读"></a>导读</h3><p>我一直信奉简洁至上的原则，桌面窗口的数量越少，我的心情就越放松，开发的效率也就越高。反之，杂乱的桌面，暴涨的Chrome tab数量，或是无数的终端窗口，它们会逐步侵占我的注意力，分散我的思维，最终令我难以专注。因此桌面上我很少放文件，使用Chrome时常点 <a href="https://chrome.google.com/webstore/detail/onetab/chphlpgkkbolifaimnlloiipkdnihall" target="_blank" rel="external">OneTab</a> 回收标签页，切进终端时使用tmux管理窗口。</p>
<p>那么，有没有可能开机后不需要任何操作，本地的十几种web开发服务就自动运行？当然我不希望连续弹出十几个窗口或是tab，我需要的是静默无感知的启用服务，然后还能快速地进入到现场进行操作，web服务运行时不占据终端窗口，关闭iTem2后操作现场不会被销毁。诸如此类，tmux都能实现，除了这些，tmux还能做得更多更好。</p>
<p>到目前为止，tmux帮助我两年有余，它带给我许多惊喜。独乐不如众乐，愿你也能一同享受tmux带来的快乐。</p>
<a id="more"></a>
<h3 id="简介"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E7%AE%80%E4%BB%8B" class="headerlink" title="简介"></a>简介</h3><p>tmux是一款优秀的终端复用软件，它比Screen更加强大，至于如何强大，网上有大量的文章讨论了这点，本文不再重复。tmux之所以受人们喜爱，主要得益于以下三处功能：</p>
<ul>
<li>丝滑分屏（split），虽然iTem2也提供了横向和竖向分屏功能，但这种分屏功能非常拙劣，完全等同于屏幕新开一个窗口，新开的pane不会自动进入到当前目录，也没有记住当前登录状态。这意味着如果我ssh进入到远程服务器时，iTem2新开的pane中，我依然要重新走一遍ssh登录的老路（omg）。tmux就不会这样，tmux窗口中，新开的pane，默认进入到之前的路径，如果是ssh连接，登录状态也依旧保持着，如此一来，我就可以随意的增删pane，这种灵活性，好处不言而喻。</li>
<li>保护现场（attach），即使命令行的工作只进行到一半，关闭终端后还可以重新进入到操作现场，继续工作。对于ssh远程连接而言，即使网络不稳定也没有关系，掉线后重新连接，可以直奔现场，之前运行中的任务，依旧在跑，就好像从来没有离开过一样；特别是在远程服务器上运行耗时的任务，tmux可以帮你一直保持住会话。如此一来，你就可以随时随地放心地进行移动办公，只要你附近的计算机装有tmux（没有你也可以花几分钟装一个），你就能继续刚才的工作。</li>
<li>会话共享（适用于结对编程或远程教学），将 tmux 会话的地址分享给他人，这样他们就可以通过 SSH 接入该会话。如果你要给同事演示远程服务器的操作，他不必直勾勾地盯着你的屏幕，借助tmux，他完全可以进入到你的会话，然后静静地看着他桌面上你风骚的键盘走位，只要他愿意，甚至还可以录个屏。</li>
</ul>
<p>以上，只是主要功能，更多功能还在后头，接下来我将详细地介绍tmux的使用技巧。</p>
<h3 id="安装"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%AE%89%E8%A3%85" class="headerlink" title="安装"></a>安装</h3><p>首先安装之。</p>
<p>在Mac中安装：</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-comment"># 先安装Homebrew，有则跳过</span>
ruby <span class="hljs-_">-e</span> <span class="hljs-string">"<span class="hljs-variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span>
<span class="hljs-comment"># 安装tmux</span>
brew install tmux
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul></pre>
<p>在Linux中安装：</p>
<pre><code class="bash hljs has-numbering">sudo apt-get install tmux
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<h3 id="基本概念"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" class="headerlink" title="基本概念"></a>基本概念</h3><p>开始之前，我们先了解下基本概念：</p>
<p>tmux采用C/S模型构建，输入tmux命令就相当于开启了一个服务器，此时默认将新建一个会话，然后会话中默认新建一个窗口，窗口中默认新建一个面板。会话、窗口、面板之间的联系如下：</p>
<p>一个tmux <code>session</code>（会话）可以包含多个<code>window</code>（窗口），窗口默认充满会话界面，因此这些窗口中可以运行相关性不大的任务。</p>
<p>一个<code>window</code>又可以包含多个<code>pane</code>（面板），窗口下的面板，都处于同一界面下，这些面板适合运行相关性高的任务，以便同时观察到它们的运行情况。</p>
<p><a href="./tmux_files/tmux01.png" title="基本概念" rel="fancy-group" class="fancy-ctn fancybox"><img src="./tmux_files/tmux01.png" title="基本概念"></a></p>
<h3 id="会话"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E4%BC%9A%E8%AF%9D" class="headerlink" title="会话"></a>会话</h3><h4 id="新建会话"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%96%B0%E5%BB%BA%E4%BC%9A%E8%AF%9D" class="headerlink" title="新建会话"></a>新建会话</h4><p>新建一个tmux session非常简单，语法为<code>tmux new -s session-name</code>，也可以简写为<code>tmux</code>，为了方便管理，建议指定会话名称，如下。</p>
<pre><code class="bash hljs has-numbering">tmux <span class="hljs-comment"># 新建一个无名称的会话</span>
tmux new <span class="hljs-_">-s</span> demo <span class="hljs-comment"># 新建一个名称为demo的会话</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<h4 id="断开当前会话"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%96%AD%E5%BC%80%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D" class="headerlink" title="断开当前会话"></a>断开当前会话</h4><p>会话中操作了一段时间，我希望断开会话同时下次还能接着用，怎么做？此时可以使用detach命令。</p>
<pre><code class="bash hljs has-numbering">tmux detach <span class="hljs-comment"># 断开当前会话，会话在后台运行</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>也许你觉得这个太麻烦了，是的，tmux的会话中，我们已经可以使用tmux快捷键了。使用快捷键组合<code>Ctrl+b</code> + <code>d</code>，三次按键就可以断开当前会话。</p>
<h4 id="进入之前的会话"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E8%BF%9B%E5%85%A5%E4%B9%8B%E5%89%8D%E7%9A%84%E4%BC%9A%E8%AF%9D" class="headerlink" title="进入之前的会话"></a>进入之前的会话</h4><p>断开会话后，想要接着上次留下的现场继续工作，就要使用到tmux的attach命令了，语法为<code>tmux attach-session -t session-name</code>，可简写为<code>tmux a -t session-name</code> 或 <code>tmux a</code>。通常我们使用如下两种方式之一即可：</p>
<pre><code class="bash hljs has-numbering">tmux a <span class="hljs-comment"># 默认进入第一个会话</span>
tmux a -t demo <span class="hljs-comment"># 进入到名称为demo的会话</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<h4 id="关闭会话"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%85%B3%E9%97%AD%E4%BC%9A%E8%AF%9D" class="headerlink" title="关闭会话"></a>关闭会话</h4><p>会话的使命完成后，一定是要关闭的。我们可以使用tmux的kill命令，kill命令有<code>kill-pane</code>、<code>kill-server</code>、<code>kill-session</code> 和 <code>kill-window</code>共四种，其中<code>kill-session</code>的语法为<code>tmux kill-session -t session-name</code>。如下：</p>
<pre><code class="bash hljs has-numbering">tmux <span class="hljs-built_in">kill</span>-session -t demo <span class="hljs-comment"># 关闭demo会话</span>
tmux <span class="hljs-built_in">kill</span>-server <span class="hljs-comment"># 关闭服务器，所有的会话都将关闭</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<h4 id="查看所有的会话"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%9A%84%E4%BC%9A%E8%AF%9D" class="headerlink" title="查看所有的会话"></a>查看所有的会话</h4><p>管理会话的第一步就是要查看所有的会话，我们可以使用如下命令：</p>
<pre><code class="bash hljs has-numbering">tmux list-session <span class="hljs-comment"># 查看所有会话</span>
tmux ls <span class="hljs-comment"># 查看所有会话，提倡使用简写形式</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<p>如果刚好处于会话中怎么办？别担心，我们可以使用对应的tmux快捷键<code>Ctrl+b</code> + <code>s</code>，此时tmux将打开一个会话列表，按上下键(⬆︎⬇︎)或者鼠标滚轮，可选中目标会话，按左右键（⬅︎➜）可收起或展开会话的窗口，选中目标会话或窗口后，按回车键即可完成切换。</p>
<p><a href="./tmux_files/tmux02.png" title="查看会话" rel="fancy-group" class="fancy-ctn fancybox"><img src="./tmux_files/tmux02.png" title="查看会话"></a></p>
<h3 id="Tmux快捷指令"><a href="http://louiszhai.github.io/2017/09/30/tmux/#Tmux%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4" class="headerlink" title="Tmux快捷指令"></a>Tmux快捷指令</h3><p>关于快捷指令，首先要认识到的是：tmux的所有指令，都包含同一个前缀，默认为<code>Ctrl+b</code>，输入完前缀过后，控制台激活，命令按键才能生效。前面tmux会话相关的操作中，我们共用到了两个快捷键<code>Ctrl+b</code> + <code>d</code>、<code>Ctrl+b</code> + <code>s</code>，但这仅仅是冰山一角，欲窥tmux庞大的快捷键体系，请看下表。</p>
<p>表一：系统指令。</p>
<table>
<thead>
<tr>
<th style="text-align:center">前缀</th>
<th style="text-align:center">指令</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>?</code></td>
<td style="text-align:center">显示快捷键帮助文档</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>d</code></td>
<td style="text-align:center">断开当前会话</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>D</code></td>
<td style="text-align:center">选择要断开的会话</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>Ctrl+z</code></td>
<td style="text-align:center">挂起当前会话</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>r</code></td>
<td style="text-align:center">强制重载当前会话</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>s</code></td>
<td style="text-align:center">显示会话列表用于选择并切换</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>:</code></td>
<td style="text-align:center">进入命令行模式，此时可直接输入<code>ls</code>等命令</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>[</code></td>
<td style="text-align:center">进入复制模式，按<code>q</code>退出</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>]</code></td>
<td style="text-align:center">粘贴复制模式中复制的文本</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>~</code></td>
<td style="text-align:center">列出提示信息缓存</td>
</tr>
</tbody>
</table>
<p>表二：窗口（window）指令。</p>
<table>
<thead>
<tr>
<th style="text-align:center">前缀</th>
<th style="text-align:center">指令</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>c</code></td>
<td style="text-align:center">新建窗口</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>&amp;</code></td>
<td style="text-align:center">关闭当前窗口（关闭前需输入<code>y</code> or <code>n</code>确认）</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>0~9</code></td>
<td style="text-align:center">切换到指定窗口</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>p</code></td>
<td style="text-align:center">切换到上一窗口</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>n</code></td>
<td style="text-align:center">切换到下一窗口</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>w</code></td>
<td style="text-align:center">打开窗口列表，用于且切换窗口</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>,</code></td>
<td style="text-align:center">重命名当前窗口</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>.</code></td>
<td style="text-align:center">修改当前窗口编号（适用于窗口重新排序）</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>f</code></td>
<td style="text-align:center">快速定位到窗口（输入关键字匹配窗口名称）</td>
</tr>
</tbody>
</table>
<p>表三：面板（pane）指令。</p>
<table>
<thead>
<tr>
<th style="text-align:center">前缀</th>
<th style="text-align:center">指令</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>"</code></td>
<td style="text-align:center">当前面板上下一分为二，下侧新建面板</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>%</code></td>
<td style="text-align:center">当前面板左右一分为二，右侧新建面板</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>x</code></td>
<td style="text-align:center">关闭当前面板（关闭前需输入<code>y</code> or <code>n</code>确认）</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>z</code></td>
<td style="text-align:center">最大化当前面板，再重复一次按键后恢复正常（v1.8版本新增）</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>!</code></td>
<td style="text-align:center">将当前面板移动到新的窗口打开（原窗口中存在两个及以上面板有效）</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>;</code></td>
<td style="text-align:center">切换到最后一次使用的面板</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>q</code></td>
<td style="text-align:center">显示面板编号，在编号消失前输入对应的数字可切换到相应的面板</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>{</code></td>
<td style="text-align:center">向前置换当前面板</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>}</code></td>
<td style="text-align:center">向后置换当前面板</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>Ctrl+o</code></td>
<td style="text-align:center">顺时针旋转当前窗口中的所有面板</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>方向键</code></td>
<td style="text-align:center">移动光标切换面板</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>o</code></td>
<td style="text-align:center">选择下一面板</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>空格键</code></td>
<td style="text-align:center">在自带的面板布局中循环切换</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>Alt+方向键</code></td>
<td style="text-align:center">以5个单元格为单位调整当前面板边缘</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>Ctrl+方向键</code></td>
<td style="text-align:center">以1个单元格为单位调整当前面板边缘（Mac下被系统快捷键覆盖）</td>
</tr>
<tr>
<td style="text-align:center"><code>Ctrl+b</code></td>
<td style="text-align:center"><code>t</code></td>
<td style="text-align:center">显示时钟</td>
</tr>
</tbody>
</table>
<p>tmux的丝滑分屏功能正是得益于以上系统、窗口、面板的快捷指令，只要你愿意，你就可以解除任意的快捷指令，然后绑上你喜欢的指令，当然这就涉及到它的可配置性了，请继续往下读。</p>
<h3 id="灵活的配置性"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E7%81%B5%E6%B4%BB%E7%9A%84%E9%85%8D%E7%BD%AE%E6%80%A7" class="headerlink" title="灵活的配置性"></a>灵活的配置性</h3><p>除了快捷指令外，tmux还提供了类似vim的配置性功能。可配置性是软件的一项进阶级功能，只有具备了可配置性，软件才有了鲜活的个性，用户才能体会到操作的快感。</p>
<h4 id="修改指令前缀"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E4%BF%AE%E6%94%B9%E6%8C%87%E4%BB%A4%E5%89%8D%E7%BC%80" class="headerlink" title="修改指令前缀"></a>修改指令前缀</h4><p>相信只要你用过几次tmux，就会发现<code>Ctrl+b</code>指令前缀，着实不太方便。这两个键相距太远，按键成本太高了。因此我们首先需要将它更换为距离更近的<code>Ctrl+a</code>组合键，或者不常用的 ` 键（当然其他键也是可以的）。</p>
<p>tmux的用户级配置文件为<code>~/.tmux.conf</code>（没有的话就创建一个），修改快捷指令，只需要增加如下三行即可。</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-built_in">set</span> -g prefix C<span class="hljs-_">-a</span> <span class="hljs-comment">#</span>
unbind C-b <span class="hljs-comment"># C-b即Ctrl+b键，unbind意味着解除绑定</span>
<span class="hljs-built_in">bind</span> C<span class="hljs-_">-a</span> send-prefix <span class="hljs-comment"># 绑定Ctrl+a为新的指令前缀</span>

<span class="hljs-comment"># 从tmux v1.6版起，支持设置第二个指令前缀</span>
<span class="hljs-built_in">set</span>-option -g prefix2 ` <span class="hljs-comment"># 设置一个不常用的`键作为指令前缀，按键更快些</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li></ul></pre>
<p>修改的<code>~/.tmux.conf</code>配置文件有如下两种方式可以令其生效：</p>
<ul>
<li>restart tmux。</li>
<li>在tmux窗口中，先按下<code>Ctrl+b</code>指令前缀，然后按下系统指令<code>:</code>，进入到命令模式后输入<code>source-file ~/.tmux.conf</code>，回车后生效。</li>
</ul>
<p>既然快捷指令如此方便，更为优雅的做法是新增一个加载配置文件的快捷指令 ，这样就可以随时随地load新的配置了，如下所示。</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-comment"># 绑定快捷键为r</span>
<span class="hljs-built_in">bind</span> r <span class="hljs-built_in">source</span>-file ~/.tmux.conf \; display-message <span class="hljs-string">"Config reloaded.."</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<p>请特别注意，在已经创建的窗口中，即使加载了新的配置，旧的配置依然有效（只要你新加的功能没有覆盖旧的配置，因此如果你第一次绑定快捷指令为<code>x</code>键，然后又改为绑定<code>y</code>键，那么<code>x</code>和<code>y</code>都将有效），新建会话不受此影响，将直接采用新的配置。</p>
<p>既然我们已经迈出配置化的第一步，那么接下来我们可以做得更多。</p>
<h4 id="新增面板"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%96%B0%E5%A2%9E%E9%9D%A2%E6%9D%BF" class="headerlink" title="新增面板"></a>新增面板</h4><p>tmux中，使用最多的功能之一就是新增一个面板。水平方向新增面板的指令是 <code>prefix</code>  + <code>"</code> ，垂直方向是 <code>prefix</code> + <code>%</code>，<code>"</code> 和 <code>%</code>需要两个键同时按下才能完成，加上指令前缀至少需要3~4次按键才能组成一个完整的指令，同时这个两个键也不够醒目和方便，因此我们可以绑定两个更常用的指令 <code>-</code>、<code>|</code>，如下所示：</p>
<pre><code class="bash hljs has-numbering">unbind <span class="hljs-string">'"'</span>
<span class="hljs-built_in">bind</span> - splitw -v -c <span class="hljs-string">'#{pane_current_path}'</span> <span class="hljs-comment"># 垂直方向新增面板，默认进入当前目录</span>
unbind %
<span class="hljs-built_in">bind</span> | splitw -h -c <span class="hljs-string">'#{pane_current_path}'</span> <span class="hljs-comment"># 水平方向新增面板，默认进入当前目录</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul></pre>
<h4 id="开启鼠标支持"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%BC%80%E5%90%AF%E9%BC%A0%E6%A0%87%E6%94%AF%E6%8C%81" class="headerlink" title="开启鼠标支持"></a>开启鼠标支持</h4><p>默认情况下，tmux的多窗口之间的切换以及面板大小调整，需要输入指令才能完成，这一过程，涉及到的指令较多，而且操作麻烦，特别是面板大小调整，指令难以一步到位，这个时候开启鼠标支持就完美了。</p>
<p>对于tmux v2.1(2015.10.28)之前的版本，需加入如下配置：</p>
<pre><code class="bash hljs has-numbering">setw -g mode-mouse on <span class="hljs-comment"># 支持鼠标选取文本等</span>
setw -g mouse-resize-pane on <span class="hljs-comment"># 支持鼠标拖动调整面板的大小(通过拖动面板间的分割线)</span>
setw -g mouse-select-pane on <span class="hljs-comment"># 支持鼠标选中并切换面板</span>
setw -g mouse-select-window on <span class="hljs-comment"># 支持鼠标选中并切换窗口(通过点击状态栏窗口名称)</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul></pre>
<p>有的地方可能会出现<code>set-window-option</code>的写法，<code>setw</code>就是它的别名。</p>
<p>对于tmux v2.1及以上的版本，仅需加入如下配置：</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-built_in">set</span>-option -g mouse on <span class="hljs-comment"># 等同于以上4个指令的效果</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>需要注意的是，开启鼠标支持后，iTem2默认的鼠标选中即复制功能需要同时按下 <code>Alt</code> 键，才会生效。</p>
<h4 id="快速面板切换"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%BF%AB%E9%80%9F%E9%9D%A2%E6%9D%BF%E5%88%87%E6%8D%A2" class="headerlink" title="快速面板切换"></a>快速面板切换</h4><p>鼠标支持确实能带来很大的便捷性，特别是对于习惯了鼠标操作的tmux新手，但对于键盘爱好者而言，这不是什么好消息，对他们而言，双手不离键盘是基本素质。</p>
<p>虽然指令前缀加<code>方向键</code>可以切换面板，但<code>方向键</code>太远，不够快，不够Geek。没关系，我们可以将面板切换升级为熟悉的<code>h</code>、<code>j</code>、<code>k</code>、<code>l</code>键位。</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-comment"># 绑定hjkl键为面板切换的上下左右键</span>
<span class="hljs-built_in">bind</span> -r k select-pane -U <span class="hljs-comment"># 绑定k为↑</span>
<span class="hljs-built_in">bind</span> -r j select-pane -D <span class="hljs-comment"># 绑定j为↓</span>
<span class="hljs-built_in">bind</span> -r h select-pane -L <span class="hljs-comment"># 绑定h为←</span>
<span class="hljs-built_in">bind</span> -r l select-pane -R <span class="hljs-comment"># 绑定l为→</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul></pre>
<p><code>-r</code>表示可重复按键，大概500ms之内，重复的<code>h</code>、<code>j</code>、<code>k</code>、<code>l</code>按键都将有效，完美支持了快速切换的Geek需求。</p>
<p>除了上下左右外， 还有几个快捷指令可以设置。</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-built_in">bind</span> -r e lastp <span class="hljs-comment"># 选择最后一个面板</span>
<span class="hljs-built_in">bind</span> -r ^e last <span class="hljs-comment"># 选择最后一个窗口</span>

<span class="hljs-built_in">bind</span> -r ^u swapp -U <span class="hljs-comment"># 与前一个面板交换位置</span>
<span class="hljs-built_in">bind</span> -r ^d swapp -D <span class="hljs-comment"># 与后一个面板交换位置</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul></pre>
<h4 id="面板大小调整"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E9%9D%A2%E6%9D%BF%E5%A4%A7%E5%B0%8F%E8%B0%83%E6%95%B4" class="headerlink" title="面板大小调整"></a>面板大小调整</h4><p>习惯了全键盘操作后，命令的便捷性不言而喻。既然面板切换的指令都可以升级，面板大小调整的指令自然也不能落后。如下配置就可以升级你的操作：</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-comment"># 绑定Ctrl+hjkl键为面板上下左右调整边缘的快捷指令</span>
<span class="hljs-built_in">bind</span> -r ^k resizep -U 10 <span class="hljs-comment"># 绑定Ctrl+k为往↑调整面板边缘10个单元格</span>
<span class="hljs-built_in">bind</span> -r ^j resizep -D 10 <span class="hljs-comment"># 绑定Ctrl+j为往↓调整面板边缘10个单元格</span>
<span class="hljs-built_in">bind</span> -r ^h resizep -L 10 <span class="hljs-comment"># 绑定Ctrl+h为往←调整面板边缘10个单元格</span>
<span class="hljs-built_in">bind</span> -r ^l resizep -R 10 <span class="hljs-comment"># 绑定Ctrl+l为往→调整面板边缘10个单元格</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li></ul></pre>
<p>以上，<code>resizep</code>即<code>resize-pane</code>的别名。</p>
<h4 id="面板最大化"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E9%9D%A2%E6%9D%BF%E6%9C%80%E5%A4%A7%E5%8C%96" class="headerlink" title="面板最大化"></a>面板最大化</h4><p>当窗口中面板的数量逐渐增多时，每个面板的空间就会逐渐减少。为了保证有足够的空间显示内容，tmux从v1.8版本起，提供了面板的最大化功能，输入<code>tmux-prefix+z</code>，就可以最大化当前面板至窗口大小，只要再重复输入一次，便恢复正常。那么tmux v1.8以下的版本，怎么办呢？别急，有大神提供了如下的解决方案。</p>
<p>首先编写一个zoom脚本，该脚本通过新建一个窗口，交换当前面板与新的窗口默认面板位置，来模拟最大的功能；通过重复一次按键，还原面板位置，并关闭新建的窗口，来模拟还原功能，如下所示：</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-comment">#!/bin/bash -f</span>
currentwindow=`tmux list-window | tr <span class="hljs-string">'\t'</span> <span class="hljs-string">' '</span> | sed -n <span class="hljs-_">-e</span> <span class="hljs-string">'/(active)/s/^[^:]*: *\([^ ]*\) .*/\1/gp'</span>`;
currentpane=`tmux list-panes | sed -n <span class="hljs-_">-e</span> <span class="hljs-string">'/(active)/s/^\([^:]*\):.*/\1/gp'</span>`;
panecount=`tmux list-panes | wc | sed <span class="hljs-_">-e</span> <span class="hljs-string">'s/^ *//g'</span> <span class="hljs-_">-e</span> <span class="hljs-string">'s/ .*$//g'</span>`;
inzoom=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$currentwindow</span> | sed -n <span class="hljs-_">-e</span> <span class="hljs-string">'/^zoom/p'</span>`;
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$panecount</span> <span class="hljs-_">-ne</span> 1 ]; <span class="hljs-keyword">then</span>
    inzoom=<span class="hljs-string">""</span>;
<span class="hljs-keyword">fi</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$inzoom</span> ]; <span class="hljs-keyword">then</span>
    lastpane=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$currentwindow</span> | rev | cut <span class="hljs-_">-f</span> 1 <span class="hljs-_">-d</span> <span class="hljs-string">'@'</span> | rev`;
    lastwindow=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$currentwindow</span> | cut <span class="hljs-_">-f</span> 2- <span class="hljs-_">-d</span> <span class="hljs-string">'@'</span> | rev | cut <span class="hljs-_">-f</span> 2- <span class="hljs-_">-d</span> <span class="hljs-string">'@'</span> | rev`;
    tmux select-window -t <span class="hljs-variable">$lastwindow</span>;
    tmux select-pane -t <span class="hljs-variable">$lastpane</span>;
    tmux swap-pane <span class="hljs-_">-s</span> <span class="hljs-variable">$currentwindow</span>;
    tmux <span class="hljs-built_in">kill</span>-window -t <span class="hljs-variable">$currentwindow</span>;
<span class="hljs-keyword">else</span>
    newwindowname=zoom@<span class="hljs-variable">$currentwindow</span>@<span class="hljs-variable">$currentpane</span>;
    tmux new-window <span class="hljs-_">-d</span> -n <span class="hljs-variable">$newwindowname</span>;
    tmux swap-pane <span class="hljs-_">-s</span> <span class="hljs-variable">$newwindowname</span>;
    tmux select-window -t <span class="hljs-variable">$newwindowname</span>;
<span class="hljs-keyword">fi</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li></ul></pre>
<p>不妨将该脚本存放在<code>~/.tmux</code>目录中（没有则新建目录），接下来只需要绑定一个快捷指令就行，如下。</p>
<pre><code class="bash hljs has-numbering">unbind z
<span class="hljs-built_in">bind</span> z run <span class="hljs-string">". ~/.tmux/zoom"</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<h4 id="窗口变为面板"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E7%AA%97%E5%8F%A3%E5%8F%98%E4%B8%BA%E9%9D%A2%E6%9D%BF" class="headerlink" title="窗口变为面板"></a>窗口变为面板</h4><p>通过上面的zoom脚本，面板可以轻松地最大化为一个新的窗口。那么反过来，窗口是不是可以最小化为一个面板呢？</p>
<blockquote>
<p>试想这样一个场景：当你打开多个窗口后，然后想将其中几个窗口合并到当前窗口中，以便对比观察输出。</p>
</blockquote>
<p>实际上，你的要求就是将其它窗口变成面板，然后合并到当前窗口中。对于这种操作，我们可以在当前窗口，按下<code>prefix</code> + <code>:</code>，打开命令行，然后输入如下命令：</p>
<pre><code class="bash hljs has-numbering">join-pane <span class="hljs-_">-s</span> window01 <span class="hljs-comment"># 合并名称为window01的窗口的默认（第一个）面板到当前窗口中</span>
join-pane <span class="hljs-_">-s</span> window01.1 <span class="hljs-comment"># .1显式指定了第一个面板，.2就是第二个面板(我本地将面板编号起始值设置为1，默认是0)</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<p>每次执行<code>join-pane</code>命令都会合并一个面板，并且指定的窗口会减少一个面板，直到面板数量为0，窗口关闭。</p>
<p>除了在当前会话中操作外，<code>join-pane</code>命令甚至可以从其它指定会话中合并面板，格式为<code>join-pane -s [session_name]:[window].[pane]</code>，如<code>join-pane -s 2:1.1</code> 即合并第二个会话的第一个窗口的第一个面板到当前窗口，当目标会话的窗口和面板数量为0时，会话便会关闭。</p>
<p>注：上一节中的<code>swap-pane</code>命令与<code>join-pane</code>语法基本一致。</p>
<h4 id="其他配置"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE" class="headerlink" title="其他配置"></a>其他配置</h4><pre><code class="bash hljs has-numbering"><span class="hljs-built_in">bind</span> m <span class="hljs-built_in">command</span>-prompt <span class="hljs-string">"splitw -h 'exec man %%'"</span>   <span class="hljs-comment"># 绑定m键为在新的panel打开man</span>
<span class="hljs-comment"># 绑定P键为开启日志功能，如下，面板的输出日志将存储到桌面</span>
<span class="hljs-built_in">bind</span> P pipe-pane -o <span class="hljs-string">"cat &gt;&gt;~/Desktop/#W.log"</span> \; display <span class="hljs-string">"Toggled logging to ~/Desktop/#W.log"</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li></ul></pre>
<h4 id="恢复用户空间"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E6%81%A2%E5%A4%8D%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4" class="headerlink" title="恢复用户空间"></a><strong>恢复用户空间</strong></h4><p>tmux会话中，Mac的部分命令如 <code>osascript</code>、<code>open</code>、<code>pbcopy</code> 或 <code>pbpaste</code>等可能会失效（失效命令未列全）。</p>
<p>部分bug列表如下：</p>
<ul>
<li><a href="https://apple.stackexchange.com/questions/174779/unable-to-run-display-notification-using-osascript-in-a-tmux-session" target="_blank" rel="external">applescript - Unable to run ‘display notification’ using osascript in a tmux session</a></li>
<li><a href="https://stackoverflow.com/questions/30404944/open-command-doesnt-work-properly-inside-tmux/30412054#30412054" target="_blank" rel="external">osx - “open” command doesn’t work properly inside tmux</a></li>
<li><a href="https://stackoverflow.com/questions/16618992/cant-paste-into-macvim/16661806#16661806" target="_blank" rel="external">clipboard - Can’t paste into MacVim</a></li>
</ul>
<p>对此，我们可以通过安装<code>reattach-to-user-namespace</code>包装程序来解决这个问题。</p>
<pre><code class="bash hljs has-numbering">brew install reattach-to-user-namespace
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>在<code>~/.tmux.conf</code>中添加配置：</p>
<pre><code class="hljs bash has-numbering"><span class="hljs-built_in">set</span> -g default-command <span class="hljs-string">"reattach-to-user-namespace -l <span class="hljs-variable">$SHELL</span>"</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>这样你的交互式shell最终能够重新连接到用户级的命名空间。由于连接状态能够被子进程继承，故以上配置保证了所有从 shell 启动的命令能够被正确地连接。</p>
<p>有些时候，我们可能会在不同的操作系统中共享配置文件，如果你的tmux版本大于1.9，我们还可以使用<code>if-shell</code>来判断是否Mac系统，然后再指定<code>default-command</code>。</p>
<pre><code class="hljs sql has-numbering">if-shell 'test "$(uname -s)" = Darwin' '<span class="hljs-keyword">set</span>-<span class="hljs-keyword">option</span> -g <span class="hljs-keyword">default</span>-command <span class="hljs-string">"exec reattach-to-user-namespace -l $SHELL"</span><span class="hljs-string">'
</span></code><ul class="pre-numbering"><li>1</li></ul></pre><p>对于tmux v1.8及更早的版本，可以使用如下包装后的配置：</p>
<pre><code class="hljs sql has-numbering"><span class="hljs-keyword">set</span>-<span class="hljs-keyword">option</span> -g <span class="hljs-keyword">default</span>-command <span class="hljs-string">'command -v reattach-to-user-namespace &gt;/dev/null &amp;&amp; exec reattach-to-user-namespace -l "$SHELL" || exec "$SHELL"'</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>以上，<code>$SHELL</code>对应于你的默认Shell，通常是<code>/usr/bin/bash</code> 或 <code>/usr/local/bin/zsh</code>。</p>
<h3 id="复制模式"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F" class="headerlink" title="复制模式"></a>复制模式</h3><p>tmux中操作文本，自然离不开复制模式，通常使用复制模式的步骤如下：</p>
<ol>
<li>输入 <code>`+[</code> 进入复制模式</li>
<li>按下 <code>空格键</code> 开始复制，移动光标选择复制区域</li>
<li>按下 <code>回车键</code> 复制选中文本并退出复制模式</li>
<li>按下 <code>`+]</code> 粘贴文本</li>
</ol>
<p>查看复制模式默认的快捷键风格：</p>
<pre><code class="bash hljs has-numbering">tmux show-window-options -g mode-keys <span class="hljs-comment"># mode-keys emacs</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>默认情况下，快捷键为<code>emacs</code>风格。</p>
<p>为了让复制模式更加方便，我们可以将快捷键设置为熟悉的<code>vi</code>风格，如下：</p>
<pre><code class="hljs nginx has-numbering"><span class="hljs-attribute">setw</span> -g mode-keys vi <span class="hljs-comment"># 开启vi风格后，支持vi的C-d、C-u、hjkl等快捷键</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><h4 id="自定义复制和选择快捷键"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%8D%E5%88%B6%E5%92%8C%E9%80%89%E6%8B%A9%E5%BF%AB%E6%8D%B7%E9%94%AE" class="headerlink" title="自定义复制和选择快捷键"></a><strong>自定义复制和选择快捷键</strong></h4><p>除了快捷键外，复制模式的启用、选择、复制、粘贴等按键也可以向<code>vi</code>风格靠拢。</p>
<pre><code class="hljs bash has-numbering"><span class="hljs-built_in">bind</span> Escape copy-mode <span class="hljs-comment"># 绑定esc键为进入复制模式</span>
<span class="hljs-built_in">bind</span> -t vi-copy v begin-selection <span class="hljs-comment"># 绑定v键为开始选择文本</span>
<span class="hljs-built_in">bind</span> -t vi-copy y copy-selection <span class="hljs-comment"># 绑定y键为复制选中文本</span>
<span class="hljs-built_in">bind</span> p pasteb <span class="hljs-comment"># 绑定p键为粘贴文本（p键默认用于进入上一个窗口，不建议覆盖）</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul></pre><p>以上，绑定 <code>v</code>、<code>y</code>两键的设置只在tmux v2.4版本以下才有效，对于v2.4及以上的版本，绑定快捷键需要使用 <code>-T</code> 选项，发送指令需要使用 <code>-X</code> 选项，请参考如下设置：</p>
<pre><code class="hljs perl has-numbering"><span class="hljs-keyword">bind</span> -T copy-mode-vi v <span class="hljs-keyword">send</span>-<span class="hljs-keyword">keys</span> -X begin-selection
<span class="hljs-keyword">bind</span> -T copy-mode-vi <span class="hljs-keyword">y</span> <span class="hljs-keyword">send</span>-<span class="hljs-keyword">keys</span> -X copy-selection-<span class="hljs-keyword">and</span>-cancel
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre><h4 id="Buffer缓存"><a href="http://louiszhai.github.io/2017/09/30/tmux/#Buffer%E7%BC%93%E5%AD%98" class="headerlink" title="Buffer缓存"></a><strong>Buffer缓存</strong></h4><p>tmux复制操作的内容默认会存进<code>buffer</code>里，<code>buffer</code>是一个粘贴缓存区，新的缓存总是位于栈顶，它的操作命令如下：</p>
<pre><code class="bash hljs has-numbering">tmux list-buffers <span class="hljs-comment"># 展示所有的 buffers</span>
tmux show-buffer [-b buffer-name] <span class="hljs-comment"># 显示指定的 buffer 内容</span>
tmux choose-buffer <span class="hljs-comment"># 进入 buffer 选择页面(支持jk上下移动选择，回车选中并粘贴 buffer 内容到面板上)</span>
tmux <span class="hljs-built_in">set</span>-buffer <span class="hljs-comment"># 设置buffer内容</span>
tmux load-buffer [-b buffer-name] file-path <span class="hljs-comment"># 从文件中加载文本到buffer缓存</span>
tmux save-buffer [<span class="hljs-_">-a</span>] [-b buffer-name] path <span class="hljs-comment"># 保存tmux的buffer缓存到本地</span>
tmux paste-buffer <span class="hljs-comment"># 粘贴buffer内容到会话中</span>
tmux delete-buffer [-b buffer-name] <span class="hljs-comment"># 删除指定名称的buffer</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li></ul></pre>
<p>以上buffer操作在不指定buffer-name时，默认处理是栈顶的buffer缓存。</p>
<p>在tmux会话的命令行输入时，可以省略上述tmux前缀，其中list-buffers的操作如下所示：</p>
<p><a href="./tmux_files/tmux06.png" title="list-buffers" rel="fancy-group" class="fancy-ctn fancybox"><img src="./tmux_files/tmux06.png" title="list-buffers"></a></p>
<p>choose-buffer的操作如下所示：</p>
<p><a href="./tmux_files/tmux05.png" title="choose-buffer" rel="fancy-group" class="fancy-ctn fancybox"><img src="./tmux_files/tmux05.png" title="choose-buffer"></a></p>
<p>默认情况下，buffers内容是独立于系统粘贴板的，它存在于tmux进程中，且可以在会话间共享。</p>
<h4 id="使用系统粘贴板"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E4%BD%BF%E7%94%A8%E7%B3%BB%E7%BB%9F%E7%B2%98%E8%B4%B4%E6%9D%BF" class="headerlink" title="使用系统粘贴板"></a><strong>使用系统粘贴板</strong></h4><p>存在于tmux进程中的buffer缓存，虽然可以在会话间共享，但不能直接与系统粘贴板共享，不免有些遗憾。幸运的是，现在我们有成熟的方案来实现这个功能。</p>
<p><strong>在Linux上使用粘贴板</strong></p>
<p>通常，Linux中可以使用<code>xclip</code>工具来接入系统粘贴板。</p>
<p>首先，需要安装<code>xclip</code>。</p>
<pre><code class="bash hljs has-numbering">sudo apt-get install xclip
</code><ul class="pre-numbering"><li>1</li></ul></pre>
<p>然后，<code>.tmux.conf</code>的配置如下。</p>
<pre><code class="hljs bash has-numbering"><span class="hljs-comment"># buffer缓存复制到Linux系统粘贴板</span>
<span class="hljs-built_in">bind</span> C-c run <span class="hljs-string">" tmux save-buffer - | xclip -i -sel clipboard"</span>
<span class="hljs-comment"># Linux系统粘贴板内容复制到会话</span>
<span class="hljs-built_in">bind</span> C-v run <span class="hljs-string">" tmux set-buffer \"<span class="hljs-variable">$(xclip -o -sel clipboard)</span>\"; tmux paste-buffer"</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul></pre><p>按下<code>prefix</code> + <code>Ctrl</code> + <code>c</code> 键，buffer缓存的内容将通过<code>xlip</code>程序复制到粘贴板，按下<code>prefix</code> + <code>Ctrl</code> + <code>v</code>键，tmux将通过<code>xclip</code>访问粘贴板，然后由set-buffer命令设置给buffer缓存，最后由paste-buffer粘贴到tmux会话中。</p>
<p><strong>在Mac上使用粘贴板</strong></p>
<p>我们都知道，Mac自带 <code>pbcopy</code> 和 <code>pbpaste</code>命令，分别用于复制和粘贴，但在tmux命令中它们却不能正常运行。这里我将详细介绍下原因：</p>
<blockquote>
<p>Mac的粘贴板服务是在引导命名空间注册的。命名空间存在层次之分，更高级别的命名空间拥有访问低级别命名空间（如root引导命名空间）的权限，反之却不行。流程创建的属于Mac登录会话的一部分，它会被自动包含在用户级的引导命名空间中，因此只有用户级的命名空间才能访问粘贴板服务。tmux使用守护进程(3)库函数创建其服务器进程，在Mac OS X 10.5中，苹果改变了守护进程(3)的策略，将生成的过程从最初的引导命名空间移到了根引导命名空间。而根引导命名空间访问权限较低，这意味着tmux服务器，和它的子进程，一同失去了原引导命名空间的访问权限（即无权限访问粘贴板服务）。</p>
</blockquote>
<p>如此，我们可以使用一个小小的包装程序来重新连接到合适的命名空间，然后执行访问用户级命名空间的粘贴板服务，这个包装程序就是<code>reattach-to-user-namespace</code>。</p>
<p>那么，Mac下<code>.tmux.conf</code>的配置如下：</p>
<pre><code class="hljs bash has-numbering"><span class="hljs-comment"># buffer缓存复制到Mac系统粘贴板</span>
<span class="hljs-built_in">bind</span> C-c run <span class="hljs-string">"tmux save-buffer - | reattach-to-user-namespace pbcopy"</span>
<span class="hljs-comment"># Mac系统粘贴板内容复制到会话</span>
<span class="hljs-built_in">bind</span> C-v run <span class="hljs-string">"reattach-to-user-namespace pbpaste | tmux load-buffer - \; paste-buffer -d"</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul></pre><p><code>reattach-to-user-namespace</code> 作为包装程序来访问Mac粘贴板，按下<code>prefix</code> + <code>Ctrl</code> + <code>c</code> 键，buffer缓存的内容将复制到粘贴板，按下<code>prefix</code> + <code>Ctrl</code> + <code>v</code>键，粘贴板的内容将通过 load-buffer 加载，然后由 paste-buffer 粘贴到tmux会话中。</p>
<p>为了在复制模式中使用Mac系统的粘贴板，可做如下配置：</p>
<pre><code class="hljs perl has-numbering"><span class="hljs-comment"># 绑定y键为复制选中文本到Mac系统粘贴板</span>
<span class="hljs-keyword">bind</span>-key -T copy-mode-vi <span class="hljs-string">'y'</span> <span class="hljs-keyword">send</span>-<span class="hljs-keyword">keys</span> -X copy-<span class="hljs-keyword">pipe</span>-<span class="hljs-keyword">and</span>-cancel <span class="hljs-string">'reattach-to-user-namespace pbcopy'</span>
<span class="hljs-comment"># 鼠标拖动选中文本，并复制到Mac系统粘贴板</span>
<span class="hljs-keyword">bind</span>-key -T copy-mode-vi MouseDragEnd1Pane <span class="hljs-keyword">send</span> -X copy-<span class="hljs-keyword">pipe</span>-<span class="hljs-keyword">and</span>-cancel <span class="hljs-string">"pbcopy"</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul></pre><p>完成以上配置后记得重启tmux服务器。至此，复制模式中，按<code>y</code>键将保存选中的文本到Mac系统粘贴板，随后按<code>Command</code> + <code>v</code>键便可粘贴。</p>
<h3 id="保存Tmux会话"><a href="http://louiszhai.github.io/2017/09/30/tmux/#%E4%BF%9D%E5%AD%98Tmux%E4%BC%9A%E8%AF%9D" class="headerlink" title="保存Tmux会话"></a>保存Tmux会话</h3><p>信息时代，数据尤为重要。tmux保护现场的能力依赖于tmux进程，如果进程退出，则意味着会话数据的丢失，因此关机重启后，tmux中的会话将被清空，这不是我们想要见到的。幸运的是，目前有这样两款插件：<code>Tmux Resurrect</code> 和 <code>Tmux Continuum</code>，可以永久保存tmux会话（它们均适用于tmux v1.9及以上版本）。</p>
<h4 id="Tmux-Resurrect"><a href="http://louiszhai.github.io/2017/09/30/tmux/#Tmux-Resurrect" class="headerlink" title="Tmux Resurrect"></a>Tmux Resurrect</h4><p>Tmux Resurrect无须任何配置，就能够备份tmux会话中的各种细节，包括窗口、面板的顺序、布局、工作目录，运行程序等等数据。因此它能在系统重启后完全地恢复会话。由于其幂等的恢复机制，它不会试图去恢复一个已经存在的窗口或者面板，所以，即使你不小心多恢复了几次会话，它也不会出现问题，这样主动恢复时我们就不必担心手抖多按了一次。另外，如果你是<a href="https://github.com/tmuxinator/tmuxinator" target="_blank" rel="external">tmuxinator</a>用户，我也建议你迁移到 tmux-resurrect插件上来，具体请参考<a href="https://github.com/tmux-plugins/tmux-resurrect/blob/master/docs/migrating_from_tmuxinator.md#migrating-from-tmuxinator" target="_blank" rel="external">Migrating from <code>tmuxinator</code></a>。</p>
<p>Tmux Resurrec安装过程如下所示：</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-built_in">cd</span> ~/.tmux
mkdir plugins
git <span class="hljs-built_in">clone</span> https://github.com/tmux-plugins/tmux-resurrect.git
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li></ul></pre>
<p>安装后需在<code>~/.tmux.conf</code>中增加一行配置：</p>
<pre><code class="hljs ruby has-numbering">run-shell ~<span class="hljs-regexp">/.tmux/plugins</span><span class="hljs-regexp">/tmux-resurrect/resurrect</span>.tmux
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>至此安装成功，按下<code>prefix + r</code>重载tmux配置。</p>
<p>Tmux Resurrec提供如下两个操作：</p>
<ul>
<li><strong>保存</strong>，快捷指令是<code>prefix</code> + <code>Ctrl + s</code>，tmux状态栏在保存开始，保存后分别提示”Saving…”，”Tmux environment saved !”。</li>
<li><strong>恢复</strong>，快捷指令是<code>prefix</code> + <code>Ctrl + r</code>，tmux状态栏在恢复开始，恢复后分别提示”Restoring…”，”Tmux restore complete !”。</li>
</ul>
<p>保存时，tmux会话的详细信息会以文本文件的格式保存到<code>~/.tmux/resurrect</code>目录，恢复时则从此处读取，由于数据文件是明文的，因此你完全可以自由管理或者编辑这些会话状态文件（如果备份频繁，记得定期清除历史备份）。</p>
<p><strong>可选的配置</strong></p>
<p>Tmux Resurrec本身是免配置开箱即用的，但同时也提供了如下选项以便修改其默认设置。</p>
<pre><code class="hljs nginx has-numbering"><span class="hljs-attribute">set</span> -g <span class="hljs-variable">@resurrect</span>-save <span class="hljs-string">'S'</span> <span class="hljs-comment"># 修改保存指令为S</span>
set -g <span class="hljs-variable">@resurrect</span>-restore <span class="hljs-string">'R'</span> 修改恢复指令为R
<span class="hljs-comment"># 修改会话数据的保持路径，此处不能使用除了$HOME, $HOSTNAME, ~之外的环境变量</span>
set -g <span class="hljs-variable">@resurrect</span>-dir <span class="hljs-string">'/some/path'</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li></ul></pre><p>默认情况下只有一个保守的列表项（即<code>vi vim nvim emacs man less more tail top htop irssi mutt</code>）可以恢复，对此 <a href="https://github.com/tmux-plugins/tmux-resurrect/blob/master/docs/restoring_programs.md" target="_blank" rel="external">Restoring programs doc</a> 解释了怎么去恢复额外的项目。</p>
<p><strong>进阶的备份</strong></p>
<p>除了基础备份外，Tmux Resurrec还提供<strong>进阶的备份功能</strong>，如下所示：</p>
<ul>
<li>恢复vim 和 neovim 会话</li>
<li>恢复面板内容</li>
<li>恢复shell的历史记录（实验性功能）</li>
</ul>
<p>进阶的备份功能默认不开启，需要特别配置。</p>
<p>1）恢复vim 和 neovim 会话，需要完成如下两步：</p>
<ul>
<li><p>通过vim的vim-obsession插件保存vim/neovim会话。</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-built_in">cd</span> ~/.vim/bundle
git <span class="hljs-built_in">clone</span> git://github.com/tpope/vim-obsession.git
vim -u NONE -c <span class="hljs-string">"helptags vim-obsession/doc"</span> -c q
</code><ul class="pre-numbering"><li>1</li><li>2</li><li>3</li></ul></pre>
</li>
<li><p>在<code>~/.tmux.conf</code>中增加两行配置：</p>
<pre><code class="hljs nginx has-numbering"><span class="hljs-attribute">set</span> -g <span class="hljs-variable">@resurrect</span>-strategy-vim <span class="hljs-string">'session'</span> <span class="hljs-comment"># for vim</span>
set -g <span class="hljs-variable">@resurrect</span>-strategy-nvim <span class="hljs-string">'session'</span> <span class="hljs-comment"># for neovim</span>
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre></li>
</ul>
<p>2）恢复面板内容，需在<code>~/.tmux.conf</code>中增加一行配置：</p>
<pre><code class="hljs nginx has-numbering"><span class="hljs-attribute">set</span> -g <span class="hljs-variable">@resurrect</span>-capture-pane-contents <span class="hljs-string">'on'</span> <span class="hljs-comment"># 开启恢复面板内容功能</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>目前使用该功能时，请确保tmux的<code>default-command</code>没有包含<code>&amp;&amp;</code> 或者<code>||</code>操作符，否则将导致<a href="https://github.com/tmux-plugins/tmux-resurrect/issues/98" target="_blank" rel="external">bug</a>。（查看<code>default-command</code>的值，请使用命令<code>tmux show -g default-command</code>。）</p>
<p>3）恢复shell的历史记录，需在<code>~/.tmux.conf</code>中增加一行配置：</p>
<pre><code class="hljs nginx has-numbering"><span class="hljs-attribute">set</span> -g <span class="hljs-variable">@resurrect</span>-save-shell-history <span class="hljs-string">'on'</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>由于技术的限制，保存时，只有无前台任务运行的面板，它的shell历史记录才能被保存。</p>
<h4 id="Tmux-Continuum"><a href="http://louiszhai.github.io/2017/09/30/tmux/#Tmux-Continuum" class="headerlink" title="Tmux Continuum"></a>Tmux Continuum</h4><p>可能你嫌手动保存和恢复太过麻烦，别担心，这不是问题。Tmux Continuum 在 Tmux Resurrec的基础上更进一步，现在保存和恢复全部自动化了，如你所愿，可以无感使用tmux，不用再担心备份问题。</p>
<p>Tmux Continuum安装过程如下所示（它依赖Tmux Resurrect，请保证已安装Tmux Resurrect插件）：</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-built_in">cd</span> ~/.tmux/plugins
git <span class="hljs-built_in">clone</span> https://github.com/tmux-plugins/tmux-continuum.git
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<p>安装后需在<code>~/.tmux.conf</code>中增加一行配置：</p>
<pre><code class="hljs ruby has-numbering">run-shell ~<span class="hljs-regexp">/.tmux/plugins</span><span class="hljs-regexp">/tmux-continuum/continuum</span>.tmux
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>Tmux Continuum默认每隔15mins备份一次，我设置的是一天一次：</p>
<pre><code class="hljs sql has-numbering"><span class="hljs-keyword">set</span> -g @continuum-<span class="hljs-keyword">save</span>-<span class="hljs-built_in">interval</span> <span class="hljs-string">'1440'</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p><strong>关闭自动备份</strong>，只需设置时间间隔为 <code>0</code> 即可：</p>
<pre><code class="hljs sql has-numbering"><span class="hljs-keyword">set</span> -g @continuum-<span class="hljs-keyword">save</span>-<span class="hljs-built_in">interval</span> <span class="hljs-string">'0'</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>想要在<strong>tmux启动时就恢复最后一次保存的会话环境</strong>，需增加如下配置：</p>
<pre><code class="hljs nginx has-numbering"><span class="hljs-attribute">set</span> -g <span class="hljs-variable">@continuum</span>-restore <span class="hljs-string">'on'</span> <span class="hljs-comment"># 启用自动恢复</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>如果不想要启动时自动恢复的功能了，直接移除上面这行就行。想要绝对确定自动恢复不会发生，就在用户根目录下创建一个<code>tmux_no_auto_restore</code>空文件（创建命令：<code>touch ~/tmux_no_auto_restore</code>），该文件存在时，自动恢复将不触发。</p>
<p>对于tmux高级用户（可能就是你）而言，同时运行多个tmux服务器也是有可能的。你可能并不希望后面启用的几个tmux服务器自动恢复或者自动保存会话。因此Tmux Continuum会优先在第一个启用的tmux服务器中生效，随后启用的tmux服务器不再享受自动恢复或自动保存会话的待遇。</p>
<p>实际上，不管Tmux Continuum功能有没有启用，或者多久保存一次，我们都有办法从状态栏知晓。Tmux Continuum提供了一个查看运行状态的插值<code>#{continuum_status}</code>，它支持<code>status-right</code> 和 <code>status-left</code>两种状态栏设置，如下所示：</p>
<pre><code class="hljs sql has-numbering"><span class="hljs-keyword">set</span> -g <span class="hljs-keyword">status</span>-<span class="hljs-keyword">right</span> <span class="hljs-string">'Continuum status: #{continuum_status}'</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>tmux运行时，<code>#{continuum_status}</code> 将显示保存的时间间隔（单位为分钟），此时状态栏会显示：</p>
<pre><code class="hljs nginx has-numbering"><span class="hljs-attribute">Continuum</span> status: <span class="hljs-number">1440</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>如果其自动保存功能关闭了，那么状态栏会显示：</p>
<pre><code class="hljs nginx has-numbering"><span class="hljs-attribute">Continuum</span> status: <span class="hljs-literal">off</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>借助Tmux Continuum插件，Mac重启时，我们甚至可以选择在<code>Terminal</code> 或者 <code>iTerm2</code> 中自动全屏启用tmux。</p>
<p>为此，需在<code>~/.tmux.conf</code>中增加一行配置：</p>
<pre><code class="hljs nginx has-numbering"><span class="hljs-attribute">set</span> -g <span class="hljs-variable">@continuum</span>-boot <span class="hljs-string">'on'</span>
</code><ul class="pre-numbering"><li>1</li></ul></pre><p>Mac下，自动启用tmux还支持如下选项：</p>
<ul>
<li><code>set -g @continuum-boot-options 'fullscreen'</code> ，<code>Terminal</code>自动全屏，tmux命令在<code>Terminal</code>中执行。</li>
<li><code>set -g @continuum-boot-options 'iterm'</code> ， <code>iTerm2</code> 替换 <code>Terminal</code> 应用，tmux命令在<code>iTerm2</code>中执行。</li>
<li><code>set -g @continuum-boot-options 'iterm,fullscreen'</code>，<code>iTerm2</code>自动全屏，tmux命令在<code>iTerm2</code>中执行。</li>
</ul>
<p>Linux中则没有这些选项，它只能设置为自动启用tmux服务器。</p>
<h4 id="Tpm"><a href="http://louiszhai.github.io/2017/09/30/tmux/#Tpm" class="headerlink" title="Tpm"></a>Tpm</h4><p>以上，我们直接安装了tmux插件。这没有问题，可当插件越来越多时，我们就会需要统一的插件管理器。因此官方提供了tpm（支持tmux v1.9及以上版本）。</p>
<p>tpm安装过程如下所示：</p>
<pre><code class="bash hljs has-numbering"><span class="hljs-built_in">cd</span> ~/.tmux/plugins
git <span class="hljs-built_in">clone</span> https://github.com/tmux-plugins/tpm
</code><ul class="pre-numbering"><li>1</li><li>2</li></ul></pre>
<p>安装后需在<code>~/.tmux.conf</code>中增加如下配置：</p>
<pre><code class="hljs ruby has-numbering"><span class="hljs-comment"># 默认需要引入的插件</span>
set -g @plugin <span class="hljs-string">'tmux-plugins/tpm'</span>
set -g @plugin <span class="hljs-string">'tmux-plugins/tmux-sensible'</span>